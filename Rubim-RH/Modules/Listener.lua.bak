---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Rubim.
--- DateTime: 05/07/2018 14:21
---
local onEvent = _G.onEvent
local CreateFrame = _G.CreateFrame
RubimRH.Listener = {}
local listeners = {}
local HL = HeroLib

local frame = CreateFrame('Frame', 'Rubim_Events')
frame:SetScript('OnEvent', function(_, event, ...)
    if not listeners[event] then return end
    for k in pairs(listeners[event]) do
        listeners[event][k](...)
    end
end)

--- Roll the Bones Tracking
--- As buff is "hidden" from the client but we get apply/refresh events for it
do
  local RtBExpiryTime = GetTime()
  function RtBRemains()
    local Remains = RtBExpiryTime - GetTime() - 1
    return Remains >= 0 and Remains or 0
  end

  HL:RegisterForSelfCombatEvent(
    function(_, _, _, _, _, _, _, _, _, _, _, SpellID)
      if SpellID == 315508 then
        RtBExpiryTime = GetTime() + 31
      end
    end,
    "SPELL_AURA_APPLIED"
  )
  HL:RegisterForSelfCombatEvent(
    function(_, _, _, _, _, _, _, _, _, _, _, SpellID)
      if SpellID == 315508 then
        RtBExpiryTime = GetTime() + math.min(40, 30 + RtBRemains(true))
      end
    end,
    "SPELL_AURA_REFRESH"
  )
  HL:RegisterForSelfCombatEvent(
    function(_, _, _, _, _, _, _, _, _, _, _, SpellID)
      if SpellID == 315508 then
        RtBExpiryTime = GetTime()
      end
    end,
    "SPELL_AURA_REMOVED"
  )
end





function RubimRH.Listener.Add(_, name, event, callback)
    if not listeners[event] then
        frame:RegisterEvent(event)
        listeners[event] = {}
    end
    listeners[event][name] = callback
end

function RubimRH.Listener.Remove(_, name, event)
    if listeners[event] then
        listeners[event][name] = nil
    end
end

function RubimRH.Listener.Trigger(_, event, ...)
    onEvent(nil, event, ...)
end